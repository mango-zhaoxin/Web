获取到用户信息之后。保存在本地的storage, 避免重复请求

小程序登录方式：
* 静默登录（游客态，访客态）
特点：新用户进来，是无感知的
如何实现的？
1. 小程序端在用户进来之后，会去默认调用 wx.login()，向微信服务器发起登录请求, 
2. 微信服务器返回一个code, 表示用户的登录凭证，此时小程序端就会有code.
3. 小程序将这个code发送给开发者服务器, 开发者服务器通过code向微信服务器发起请求，此时会将 code+appID+appSecret 传递给微信服务器，微信服务器会返回一个 session_key + openId
4. 至此，本地就会有code, session_key, openId，并与本地业务的登录态token做关联。

chatGPT内容补充：
在小程序登录过程中，小程序端、本地服务器端和微信服务器端需要进行数据传递，具体流程如下：
1. 用户打开小程序，并点击登录按钮。
2. 小程序调用 wx.login()方法，向微信服务器发起登录请求，并获取一个临时登录凭证’code‘
3. 小程序将code发送到本地服务器
4. 本地服务器接收到code之后，将code发送到微信服务器，通过微信服务器端的接口向微信服务器端发起获取 session_key 和 openId 的请求
5. 微信服务器返回 session_key 和 openId 等用户信息给本地服务器。
6. 本地服务器将 session_key 和 openId 等用户信息发送给小程序端
7. 小程序端根据session_key解密用户信息，获取用户的 openId 等信息，并保存在本地。

需要注意的是：小程序登录过程中，本地服务器端和微信服务器端之间的通信需要HTTPS协议进行加密传输，确保数据传输的安全性。另外，小程序的登录状态是有时效性的，一旦过期需要重新获取登录态。

* 用户登录（会员态）

解决复杂模块下，用户登录问题（大模块、下单、充值等多重服务）之间的串联问题

获取手机号
手机号 => 账号

getPhoneNumber(), 只能通过用户的点击去触发，点击一个按钮，才能触发，获取到手机号 

TODO: 小程序登录过程中，哪些情况下可能会出现登录超时？

1. 微信服务器返回的code过期：微信服务器返回的code具有时效性，一旦过期就无法再用于换取用户信息，此时需要重新调用wx.login()方法获取新的code。
2. 本地服务器端接口调用超时：如果本地服务器端向微信服务器端请求用户信息的接口调用超时，可能会导致登录过程中断，需要重新登录。
3. 网络不稳定或中断：如果小程序登录过程中网络不稳定或中断，可能会导致登录请求失败或超时，需要重新登录。
4. 用户拒绝授权或授权过期：如果用户拒绝授权或授权过期，可能会导致小程序无法获取用户信息，需要引导用户重新授权或重新登录。
在出现登录超时的情况下，开发者需要及时捕获异常并给出相应的提示，引导用户重新登录或进行其他操作。另外，为了提高用户体验，可以在小程序中实现自动登录或记住登录状态等功能，避免用户频繁进行登录操作。

TODO: 登录超时怎么办？

针对小程序登录过程中可能出现的登录超时情况，可以采取以下措施进行解决：

1. 对于微信服务器返回的code过期，开发者可以在小程序端设置定时器，定时重新调用wx.login()方法获取新的code。或者在本地服务器端通过设置合理的session_key有效期和定时更新机制来解决。
2. 对于本地服务器端接口调用超时，开发者可以通过设置请求超时时间、优化接口性能或采用分布式系统等措施来提高接口稳定性。
3. 对于网络不稳定或中断，开发者可以在小程序端进行网络检测和提示，避免用户进行无效的操作。或者通过设置网络重连机制等措施来提高网络稳定性。
4. 对于用户拒绝授权或授权过期，开发者可以在小程序端进行授权提示和引导，让用户重新授权或进行其他操作。或者通过缓存机制和登录状态管理来提高用户体验，避免频繁进行登录操作。
需要注意的是，在实际应用中，登录超时可能会出现多种原因和复杂情况，开发者需要根据实际需求和业务场景选择合适的解决方案，并进行有效的监控和优化。

1. 自己内部的业务和dev_server之间的超时
2. 业务的server 和 微信的server之间的超时 （code只能使用一次，只有在登录失效的时候，才去重新调用 wx.login, 生成新的 code ）

sass系统
账号
账号体系：这个账号属于什么等级的账号，这个账号有哪一些权限
模块：（套餐）当前这个账号属于什么套餐，或者说，这个账号开通了哪一些模块
动态权限：  比如我们这家公司是可以有1,3,5三个套餐的权限的，但是我的领导把我的套餐5的权限关闭了，这就是属于动态权限
 
通过 orgId 和 id 来拿到对应的数据权限信息


TODO: 问题：登录之后，长时间不操作，如何判断超时？

在小程序中，可以通过设置登录态的有效期来判断用户长时间不操作的情况，从而实现登录超时的处理。具体步骤如下：

1. 在用户登录成功后，记录下用户的登录态和登录时间。
2. 在用户进行操作时，更新用户的登录时间，重置登录态的有效期。
3. 在用户长时间不进行任何操作时，判断当前时间与用户的登录时间之差是否超过登录态的有效期。如果超过有效期，说明用户已经长时间不活跃，可以判断为登录超时，需要引导用户重新登录。
4. 为了提高用户体验，可以在用户长时间不操作时进行自动退出登录、缓存清理或其他相关操作，避免出现异常或安全风险。

需要注意的是：登录态的有效期一般设置在数小时或者数天时间，需要根据具体业务和安全风险进行合理的设置。

TODO: 小程序中常见的一些名词解释

openId：用户在当前小程序下的唯一标识
unionId： 微信开发平台下的唯一标识
session_key: 本次登录会话的密钥

getUserInfo：信息+unionId  
wx.login(): 获取 unionId + code
getUserProfile

getUserInfo：信息可以拿到：
1. 匿名头像昵称
2. default的性别地区
3. 加密后的身份标识

TODO: 缓存问题
1. 小程序中的缓冲如何清除？ --- 直接删除小程序
2. 小程序中H5的缓存如何清除？--- 待定，涉及到浏览器的缓存（强缓存和协商缓存）

TODO: 访客态和游客态如何区分？
在web应用中，通常会将用户分为访客态（Guest）和游客态（Anonymous），二者的区别如下：
1. 访客态：指未登录系统的用户。访客用户可以访问公共页面和内容，但是无法范文需要登录才能访问的受保护页面和功能。访客用户通常没有系统分配的ID, 业务费进行个性化的设置和操作。
2. 游客态：指已登录系统但未注册或未绑定账号的用户。游客用户可以访问系统的部分功能和受保护页面，但无法进行个性化的操作和数据存储。游客用户通常由系统自动分配一个临时ID, 用户表示用户身份和存储用户的临时数据，如购物车、浏览历史等。

通常，访客态和游客态的区分可以通过用户登录状态和用户ID来实现，如果用户未登录系统，则视为访客态；如果用户已经登录但是未注册或绑定账号，则视为游客态，分配一个临时ID来标识用户身份。
  
